{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8f6ce562_6606202a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2024-01-30T10:34:37Z",
      "side": 1,
      "message": "I defer to the owner of depot_tools for cipd_bin_setup.bat part.",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9717277e_92b016c6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1160859
      },
      "writtenOn": "2024-01-30T21:12:50Z",
      "side": 1,
      "message": "Thanks for this CL!\n\nI\u0027m very happy to test this when it lands, but I don\u0027t think I can really comment on the CL as I don\u0027t really understand this part of infra, or cipd.",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9d1f8ae_147c3df4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2024-01-30T23:06:11Z",
      "side": 1,
      "message": "I think this change will blow up:\n\n1. It adds a non-trivial amount of bloat to depot_tools (in particular in terms of number of small files, which is an issue for Windows). This bloat will end up in all places where depot_tools is DEPSed in, e.g. chromium/src. \n\n2. gcloud SDK is a modular SDK (it has its own little package manager built in). The CIPD package is built with a specific set of modules that are needed by infra things. By putting it in PATH, we are risking overriding existing working \"gcloud\" in PATH with the one lacking necessary modules.\n\n3. CIPD is not a security-approved way of installing gcloud on Google corp machines (go/gcloud-cli#getting-started). By putting it into depot_tools, we\u0027ll be violating this restriction. This CIPD package is primarily used to install gcloud on off-corp bots.",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65df4af7_a8746de9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1577257
      },
      "writtenOn": "2024-02-01T03:11:38Z",
      "side": 1,
      "message": "Mhm, I see...\n\nWhat about:\n\n1. I create a \"gcloud-auth\" CIPD package that only contains the files required for the `gcloud auth` commands. I managed to get the SDK minified down to \u003c10% of its size (both in number of files as well as total size) just by deleting unneeded files.\n2. I change this CL so that we don\u0027t put a `gcloud` command on the PATH.\n3. The linked page actually says that this is the case only for gLinux: \"Within Google, the only security-approved way to install the public release **on gLinux**, [..]\". This does not apply to gMac and gWindows, where it directly above that says \"You can grab the latest public release at our external site for Mac and at our external site for Windows\". As we don\u0027t need the gcloud SDK on gLinux anyway (because we can use `gcert` instead), I could change this CL to only download it on Mac and Windows platforms.\n\nWould these steps address your concerns?",
      "parentUuid": "f9d1f8ae_147c3df4",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f78b0346_bd063a71",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1577257
      },
      "writtenOn": "2024-02-01T05:49:11Z",
      "side": 1,
      "message": "(Reopening - I didn\u0027t mean to mark it as resolved...)",
      "parentUuid": "65df4af7_a8746de9",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "71dbf8c9_566549be",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2024-02-01T06:47:10Z",
      "side": 1,
      "message": "\u003e where depot_tools is DEPSed in, e.g. chromium/src.\n\nHmm, I didn\u0027t know that chromium/src/third_party/depot_tools also sets up .cipd_bin. Is this intended? Should this be fixed to not install CIPD packages when DEPSed?  \nI think there are some code that assume third_party/depot_tools CIPD packages. So, there will be some work to do.",
      "parentUuid": "f78b0346_bd063a71",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac9cdd15_ff0153e3",
        "filename": "cipd_bin_setup.bat",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1577257
      },
      "writtenOn": "2024-01-30T09:21:15Z",
      "side": 1,
      "message": "I don\u0027t know if this is the best mechanism for this purpose.\n\nPersonally, I would prefer it if we just don\u0027t use \"-log-level warning\" in this script and show the output of CIPD if it has to install updates. I assume that the intent here was that we don\u0027t want the output of wrapper scripts (which also tend to call \"cipd_bin_setup\" before they execute their wrapped tool) to be contaminated with CIPD messages. Is that the case, and is it really important? I don\u0027t know.\n\nIf that\u0027s the reason behind the `-log-level warning` and we want to keep it, what about making a distinction:\n- If \"update_depot_tools\", which is what most users will use when they update depot_tools, runs, we run \"cipd ensure\" without \"-log-level warning\", so users get good progress updates about the running installations. This should be fine, because \"update_depot_tools\" already prints a message itself.\n- For cases where cipd_bin_setup gets called by wrapper scripts, we hide the output as we do now.\n\nWDYT?",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 13,
        "endChar": 1
      },
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02991cf3_3c9ed417",
        "filename": "cipd_bin_setup.bat",
        "patchSetId": 5
      },
      "lineNbr": 13,
      "author": {
        "id": 1560543
      },
      "writtenOn": "2024-01-30T22:48:39Z",
      "side": 1,
      "message": "Some engineers may not like verbosity, but as long as it\u0027s one line update and only printed on actual update, I don\u0027t think it will be problematic. We used to have a generic \"Updating depot_tools...\", which may result in no-op, and folks didn\u0027t like it.\n\nOn more important note: have you tested this on a newly setup depot_tools? You may need to use \"%~dp0\\cipd.bat ...\".\n\nWe considered adding gcloud in the past, but decided not to due to its size. I think we should evaluate trade-offs. If gcloud is now mandatory for siso to work, it makes sense to be added. And in that case, we should take on a follow up work to move away from gsutil to gcloud gs.",
      "parentUuid": "ac9cdd15_ff0153e3",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 13,
        "endChar": 1
      },
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "48ef9f66_ec9854a5",
        "filename": "cipd_manifest.txt",
        "patchSetId": 5
      },
      "lineNbr": 76,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2024-01-30T10:34:37Z",
      "side": 1,
      "message": "I think it is fine to write like `${os\u003dlinux,mac,windows}-${arch\u003damd64,arm64}`.",
      "range": {
        "startLine": 76,
        "startChar": 25,
        "endLine": 76,
        "endChar": 33
      },
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d2451fc_60e8a5a3",
        "filename": "gcloud",
        "patchSetId": 5
      },
      "lineNbr": 1,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2024-01-30T10:34:37Z",
      "side": 1,
      "message": "Update OWNERS for this?",
      "revId": "e27113bd5e90cf30696b1292ca73500967f6dbce",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}