{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "84c37a65_dfa895b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-10-13T21:50:17Z",
      "side": 1,
      "message": "It sounds like post_build_ninja_summary.py will start failing if run on a siso build directory with a cryptic error message. Can we make it a non-cryptic error message instead? I sometimes run this script manually and I\u0027d rather it say \"siso not supported, please use \u003cblah\u003e instead\" rather than just firing an assert.",
      "revId": "c51829968b91a150c73150b56fdf89e4bb34b695",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09e9022c_5c889f83",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-10-16T04:58:25Z",
      "side": 1,
      "message": "`post_build_ninja_summary.py` can print build summary from the .ninja_log generated by Siso, now.\n\n```\n❯ NINJA_SUMMARIZE_BUILD\u003d1 autoninja -C out/rbe base\n/usr/local/google/home/jwata/chromium2/src/buildtools/reclient/bootstrap --re_proxy\u003d/usr/local/google/home/jwata/chromium2/src/buildtools/reclient/reproxy --cfg\u003d/usr/local/google/home/jwata/chromium2/src/buildtools/reclient_cfgs/reproxy.cfg\nProxy started successfully.\n4.824 s to start reproxy\n 2.53s update filegroups\n 6.30s Regenerating ninja files\n 1.84s loading build.ninja\nlocal:1472 remote:181 cache:1345 fallback:0 skip:1\ndeps log:0 logErr:0 scanErr:0\n46.70s Build Succeeded: 2998 steps - 64.20/s\n/usr/local/google/home/jwata/chromium2/src/buildtools/reclient/bootstrap --shutdown --cfg\u003d/usr/local/google/home/jwata/chromium2/src/buildtools/reclient_cfgs/reproxy.cfg\nRBE Stats: ↓ 105.47 MB, ↑ 81.73 KB, 1345 cache hits, 675 racing locals, 181 racing remotes\n0.041 s to stop reproxy\n    Longest build steps:\n          0.4s weighted to build obj/third_party/rust/link_cplusplus/v1/lib.stamp (0.0s elapsed time)\n          0.4s weighted to build obj/third_party/rust/link_cplusplus/v1/lib/liblink_cplusplus-link_cplusplus-1.rlib (0.3s elapsed time)\n          0.5s weighted to build obj/third_party/protobuf/protoc_lib/csharp_doc_comment.o (3.6s elapsed time)\n          0.5s weighted to build obj/third_party/abseil-cpp/absl/synchronization/synchronization/sem_waiter.o (3.8s elapsed time)\n          0.6s weighted to build obj/third_party/rust/cxx/v1/lib.stamp (0.0s elapsed time)\n          0.6s weighted to build obj/build/rust/cxx_rustdeps.stamp (0.0s elapsed time)\n          0.6s weighted to build obj/third_party/rust/cxx/v1/lib/libcxx-cxx-1.rlib (0.7s elapsed time)\n          0.6s weighted to build obj/build/rust/libcxx_cppdeps.a (0.0s elapsed time)\n          1.0s weighted to build libbase.so (0.4s elapsed time)\n          5.7s weighted to build build.ninja.stamp (3.6s elapsed time)\n    Time by build-step type:\n          0.0s weighted to generate 1 .dat files (0.0s elapsed time sum)\n          0.0s weighted to generate 7 .rs files (0.6s elapsed time sum)\n          0.0s weighted to generate 3 .descriptor files (0.8s elapsed time sum)\n          0.4s weighted to generate 14  files (31.4s elapsed time sum)\n          0.6s weighted to generate 82 .h files (22.5s elapsed time sum)\n          0.6s weighted to generate 12 .a files (0.2s elapsed time sum)\n          1.1s weighted to generate 10 .so files (10.6s elapsed time sum)\n          3.3s weighted to generate 58 .rlib files (72.7s elapsed time sum)\n         12.5s weighted to generate 566 .stamp files (5.7s elapsed time sum)\n         24.9s weighted to generate 2246 .o files (7166.0s elapsed time sum)\n    43.5s weighted time (7310.6s elapsed time sum, 168.2x parallelism)\n    3002 build steps completed, average of 69.06/s\n```",
      "parentUuid": "84c37a65_dfa895b9",
      "revId": "c51829968b91a150c73150b56fdf89e4bb34b695",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0cb77645_e387784c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-10-17T02:20:13Z",
      "side": 1,
      "message": "That command/output sequence doesn\u0027t demonstrate what you say it does. It shows that autoninja respects the NINJA_SUMMARIZE_BUILD variable for siso builds, but it turns out it does this by asking siso to print the summary. If you run post_build_ninja_summary.py after a siso build it just says \"Error: no metrics data?\"\n\nIt would be great if post_build_ninja_summary.py could work after a siso build. I hope we get there.",
      "parentUuid": "09e9022c_5c889f83",
      "revId": "c51829968b91a150c73150b56fdf89e4bb34b695",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7cefa2d0_89b313ad",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-10-17T03:33:31Z",
      "side": 1,
      "message": "Ah, I forgot that the post build summary script is already integrated with siso metrics.\n\nWith https://crrev.com/c/4945330, the script can switch between .ninja_log and siso_metrics.json\n\n```\n\u003e post_build_ninja_summary.py -C out/rbe --no_siso_metrics\n    Longest build steps:\n           0.6 weighted s to build out/rbe/obj/base/base/work_queue.o (12.4 s elapsed time)\n           0.6 weighted s to build out/rbe/obj/base/base/user_metrics.o (12.4 s elapsed time)\n           0.7 weighted s to build out/rbe/obj/base/base/job_task_source.o (12.5 s elapsed time)\n           0.7 weighted s to build out/rbe/obj/base/base/thread_controller_with_message_pump_impl.o (12.7 s elapsed time)\n           0.7 weighted s to build out/rbe/obj/base/base/message_pump_epoll.o (12.6 s elapsed time)\n           0.7 weighted s to build out/rbe/obj/base/base/thread_group_impl.o (12.7 s elapsed time)\n           0.7 weighted s to build out/rbe/obj/base/base/worker_thread.o (12.9 s elapsed time)\n           0.8 weighted s to build out/rbe/obj/base/base/stack_sampling_profiler.o (13.0 s elapsed time)\n           0.9 weighted s to build out/rbe/obj/base/base/thread.o (13.2 s elapsed time)\n           1.7 weighted s to build out/rbe/obj/base/base/sequence_manager_impl.o (14.1 s elapsed time)\n    Time by build-step type:\n           0.4 s weighted time to generate 1 .so (linking) files (0.4 s elapsed time sum)\n          14.1 s weighted time to generate 20 .o files (246.5 s elapsed time sum)\n    14.5 s weighted time (246.9 s elapsed time sum, 17.1x parallelism)\n    21 build steps completed, average of 1.45/s\n```\n\nFor some reasons, the summary looks different from one with siso metrics. \nWe will check what makes the difference.",
      "parentUuid": "0cb77645_e387784c",
      "revId": "c51829968b91a150c73150b56fdf89e4bb34b695",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}