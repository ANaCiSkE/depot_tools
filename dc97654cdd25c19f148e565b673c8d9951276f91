{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "d2cdba79_f5b32fd9",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1367998
      },
      "writtenOn": "2022-04-21T19:19:49Z",
      "side": 1,
      "message": "It\u0027s not clear to me what this change does, as in \n\nbase:\nif py2, return value\nif py3, return value.decode\n\nthis CL:\nif py2, return value\nif py3, return value.decode\n\nam I missing something?",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0f0567c_4131a1b2",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2022-04-21T19:40:12Z",
      "side": 1,
      "message": "Say, the value is of bytes type (eg. b\u0027\\xab\u0027). py2 doesn\u0027t distinguish between text and bytes, so return value should be fine. Whereas in py3, trying to decode it to utf-8 would throw an error. This try/finally basically makes py3 act like py2 by returns bytes type when we cannot decode value into utf-8.\n\nIn the issue that gredelston@ filed, they were trying to download (and write) serialized protobufs which seems to not be utf-8 decodable.",
      "parentUuid": "d2cdba79_f5b32fd9",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8789e1f8_b5f7c1ea",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2022-04-21T19:44:16Z",
      "side": 1,
      "message": "I guess a better implementation here would be what gredelston@ suggested - to only support bytes type in py2 \u0026 py3. However, it\u0027s a lot of changes and should prolly be done along with py2 deprecation. This is just a hacky way of getting this work without modifying the current flow.",
      "parentUuid": "c0f0567c_4131a1b2",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29c4d484_42600912",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1367998
      },
      "writtenOn": "2022-04-21T19:58:05Z",
      "side": 1,
      "message": "Right, I understand that but what I\u0027m asking here is: how does this CL change the behavior? as in, pre-CL and post-CL behavior appear to be identical for this file. is there an edge case I\u0027m not seeing that would make sense for there to be a try/finally? the pre-CL version seems to do the same thing and is simpler",
      "parentUuid": "8789e1f8_b5f7c1ea",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a164e52c_afab5b92",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2022-04-21T20:36:19Z",
      "side": 1,
      "message": "Py3 behavior pre-cl:\n---\n\n```\nvalue \u003d base64.b64decode(step_result.json.output[\u0027value\u0027]) # value \u003d b\u0027\\xab\u0027\nif sys.version_info \u003e\u003d (3,):\n  return value.decode(\u0027utf-8\u0027) # throws UnicodeDecodeError since \u0027\\xab\u0027 cannot be interpreted in unicode.\nreturn value\n```\n\nPy3 behavior post-cl:\n---\n\n```\nvalue \u003d base64.b64decode(step_result.json.output[\u0027value\u0027]) # value \u003d b\u0027\\xab\u0027\ntry:\n  # TODO(crbug.com/1227140): Clean up when py2 is no longer supported.\n  # If the file is not utf-8 encodable, return the bytes\n  if sys.version_info \u003e\u003d (3,):\n    value \u003d value.decode(\u0027utf-8\u0027) # throws UnicodeDecodeError\nfinally:\n  return value # returns b\u0027\\xab\u0027\n```",
      "parentUuid": "29c4d484_42600912",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e44b7e17_5f9e713a",
        "filename": "recipes/recipe_modules/gitiles/api.py",
        "patchSetId": 8
      },
      "lineNbr": 169,
      "author": {
        "id": 1367998
      },
      "writtenOn": "2022-04-21T20:44:25Z",
      "side": 1,
      "message": "Ah okay, thanks for explaining",
      "parentUuid": "a164e52c_afab5b92",
      "range": {
        "startLine": 163,
        "startChar": 3,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74cec3e1_ce0eb6c1",
        "filename": "recipes/recipe_modules/gitiles/test_api.py",
        "patchSetId": 8
      },
      "lineNbr": 93,
      "author": {
        "id": 1367998
      },
      "writtenOn": "2022-04-21T19:19:49Z",
      "side": 1,
      "message": "nit: add periods here and below",
      "range": {
        "startLine": 93,
        "startChar": 30,
        "endLine": 93,
        "endChar": 31
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3ddb004e_149a45f4",
        "filename": "recipes/recipe_modules/gitiles/test_api.py",
        "patchSetId": 8
      },
      "lineNbr": 93,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2022-04-21T22:17:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "74cec3e1_ce0eb6c1",
      "range": {
        "startLine": 93,
        "startChar": 30,
        "endLine": 93,
        "endChar": 31
      },
      "revId": "dc97654cdd25c19f148e565b673c8d9951276f91",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}