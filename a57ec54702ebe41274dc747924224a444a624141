{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e73b8da2_a34ca607",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1158025
      },
      "writtenOn": "2023-09-21T11:35:54Z",
      "side": 1,
      "message": "I know this is a rather big change on the first look, but I did my best to ensure that it is very readable and easy to understand.\n\nI have also extensively tested this change on Linux, macOS and Windows for all use cases that I could think of.\n\nThanks :)\n\n```\n## On Linux and macOS\n\n# Test all combinations of configs with autoninja.\nfor outdir in out/*; do\n    for summarize in 0 1; do\n        echo \"\u003d\u003d\u003d NINJA_SUMMARIZE_BUILD\u003d$summarize autoninja -C $outdir base \u003d\u003d\u003d\"\n        NINJA_SUMMARIZE_BUILD\u003d$summarize autoninja -C \"$outdir\" base\n        echo\n    done\ndone\n\n# Test that autosiso still works.\nautosiso -C out/fastbuild-siso-reclient base\n\n## On Windows\n\n# Test that autoninja.bat works.\nset NINJA_SUMMARIZE_BUILD\u003d1\nautoninja.bat -C out/broken base\nautoninja.bat -C out/fastbuild-ninja-local base\nautoninja.bat -C out/fastbuild-ninja-goma base\nautoninja.bat -C out/fastbuild-ninja-reclient base\nautoninja.bat -C out/fastbuild-siso-local base\nautoninja.bat -C out/fastbuild-siso-goma base\nautoninja.bat -C out/fastbuild-siso-reclient base\n\n# Test that autosiso still works.\nautosiso.bat -C out/fastbuild-siso-reclient base\n\n# Test ninja.bat / siso.bat\nninja.bat help\nsiso.bat help\nninja.bat /?\nsiso.bat /?\n```\n\nHere are the configs in my outdirs:\n\n```\n$ for i in out/*/args.gn; do echo $i; cat $i; echo; done\nout/fastbuild-ninja-goma/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\nuse_goma \u003d true\n\nout/fastbuild-ninja-local/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\n\nout/fastbuild-ninja-reclient/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\nuse_remoteexec \u003d true\n\nout/fastbuild-siso-goma/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\nuse_goma \u003d true\nuse_siso \u003d true\n\nout/fastbuild-siso-local/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\nuse_siso \u003d true\n\nout/fastbuild-siso-reclient/args.gn\nis_debug \u003d false\nenable_nacl \u003d false\nsymbol_level \u003d 0\nis_component_build \u003d true\nenable_precompiled_headers \u003d false\nuse_remoteexec \u003d true\nuse_siso \u003d true\n```",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "59a40170_8d69e4d4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "Just a couple of comments...\n\nAre there any more tests that can be added to cover this?",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89424301_0ea88493",
        "filename": "autoninja",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "I worry about this aspect of the change - it seems orthogonal to the goal of moving autosiso into autoninja. Thus, it increases the risk and might be better done separately.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "831e1165_14a442f2",
        "filename": "autoninja",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T06:31:06Z",
      "side": 1,
      "message": "Discussed in the team chat.\nThe CL would be like these.\n- Execute the ninja command from autoninja.py, instead of printing it.\n- Remove ninja_reclient.py\n- Move NINJA_SUMMARIZE_BUILD logic to autoninja.py\n- Move ninjalog_uploader call to auotninja.py\n- Better Windows /? support\n\nThe first one is important to be done first, so that others can be done independently.",
      "parentUuid": "89424301_0ea88493",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52a2a129_60a0bbb1",
        "filename": "autoninja.bat",
        "patchSetId": 8
      },
      "lineNbr": 2,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "nit: \nI think you don\u0027t need to change the year in the copyrights.",
      "range": {
        "startLine": 2,
        "startChar": 13,
        "endLine": 2,
        "endChar": 17
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05d4f450_526c44e1",
        "filename": "autoninja.bat",
        "patchSetId": 8
      },
      "lineNbr": 2,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-22T17:01:58Z",
      "side": 1,
      "message": "Good catch. To be more precise, you are not _supposed_ to change the year. Removing the \". All rights reserved.\" is good though.",
      "parentUuid": "52a2a129_60a0bbb1",
      "range": {
        "startLine": 2,
        "startChar": 13,
        "endLine": 2,
        "endChar": 17
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "48e6a9c8_7f52bb19",
        "filename": "autoninja.bat",
        "patchSetId": 8
      },
      "lineNbr": 16,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "Is there any reason why it changed from ninja.py to autoninja.py?",
      "range": {
        "startLine": 16,
        "startChar": 53,
        "endLine": 16,
        "endChar": 72
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d740d42_0f5fde78",
        "filename": "autoninja.bat",
        "patchSetId": 8
      },
      "lineNbr": 21,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "Is this comment obsolete?",
      "range": {
        "startLine": 21,
        "startChar": 3,
        "endLine": 21,
        "endChar": 20
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "528a3d7e_17929a66",
        "filename": "autoninja.bat",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "I have the same concerns here with the changes to the autoninja shell script. Additionally there are a lot of subtleties around .bat files. Extra things to check would be:\n- handling of the ^^ suffix (build the targets of this file)\n- handling of error codes - i.e.; making sure \"autoninja base_unittests \u0026\u0026 base_unittests.exe\" behaves properly in the success/failure case\n- make sure the command prompt title is reliably reset on exit\n\nIf this can be moved to a separate change that would reduce the risk.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df5e6f31_98fed7a1",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 12,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "Why the reformat? My counting shows that the previous line was exactly 80 characters? Not important, just wondering.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e26985d2_d8d1cc8d",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 12,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T06:31:06Z",
      "side": 1,
      "message": "extracted https://crrev.com/c/4886413",
      "parentUuid": "df5e6f31_98fed7a1",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6b91392_dc916a3f",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 96,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "You can move this to where it\u0027s used. maybe before L275?",
      "range": {
        "startLine": 96,
        "startChar": 4,
        "endLine": 96,
        "endChar": 73
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd0d834c_4b408900",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "Same thing here - previously line was exactly 80. No warning should have been triggered. Curious.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b2b85877_e156cda9",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 97,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T06:31:06Z",
      "side": 1,
      "message": "extracted the change. https://crrev.com/c/4886413",
      "parentUuid": "cd0d834c_4b408900",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "67420f88_b925a2f5",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 207,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "Why did you move these logics from the previous place?",
      "range": {
        "startLine": 178,
        "startChar": 0,
        "endLine": 207,
        "endChar": 16
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c46b3e53_8d716628",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 237,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "Was exactly 80 characters.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "361b53d3_e08fc13e",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 348,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "It doesn\u0027t make Siso fail with `-d stats` now. So, you can pass it to siso.",
      "range": {
        "startLine": 347,
        "startChar": 49,
        "endLine": 348,
        "endChar": 21
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ce80fd8_424b3ff2",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 359,
      "author": {
        "id": 1544499
      },
      "writtenOn": "2023-09-21T15:07:29Z",
      "side": 1,
      "message": "Why not avoid the additional subprocess to python here and just call ninja.main() or siso.main()?",
      "range": {
        "startLine": 358,
        "startChar": 16,
        "endLine": 359,
        "endChar": 72
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38319962_d2142b87",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 359,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T05:54:36Z",
      "side": 1,
      "message": "+1 to avoid additional subprocess.",
      "parentUuid": "9ce80fd8_424b3ff2",
      "range": {
        "startLine": 358,
        "startChar": 16,
        "endLine": 359,
        "endChar": 72
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "213794c3_91cdfd90",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 365,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "Is this exception handling necessary in addition to L393?",
      "range": {
        "startLine": 365,
        "startChar": 0,
        "endLine": 365,
        "endChar": 29
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d057e15e_3951f8f3",
        "filename": "autoninja.py",
        "patchSetId": 8
      },
      "lineNbr": 375,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T09:57:00Z",
      "side": 1,
      "message": "Probably, it can call `ninjalog_uploader_wrapper.main()` now with a small modification. But, it can be done separately.",
      "range": {
        "startLine": 375,
        "startChar": 0,
        "endLine": 375,
        "endChar": 70
      },
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e100754_98ac29a1",
        "filename": "autosiso",
        "patchSetId": 8
      },
      "lineNbr": 17,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "Does this work? If somebody is using autosiso then they probably don\u0027t have use_siso\u003dtrue set which means that autoninja.py will invoke ninja instead of siso.\nOne way to handle this would be to just fail out. If so we should specifically print the required gn arg: \"use_siso \u003d true\"",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2fc8b2b_a3390180",
        "filename": "autosiso",
        "patchSetId": 8
      },
      "lineNbr": 17,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T06:31:06Z",
      "side": 1,
      "message": "Yeah, this should fail with a message to put `use_siso\u003dtrue` and run `autoninja`.",
      "parentUuid": "3e100754_98ac29a1",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7350b15b_40c9d034",
        "filename": "autosiso.bat",
        "patchSetId": 8
      },
      "lineNbr": 28,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "See previous comments. Note that getting the redirection from autosiso.bat to autoninja.bat is particularly challenging on Windows, especially for special characters like the ^^ suffix.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb02ef1a_40fd2142",
        "filename": "ninjalog_uploader_wrapper.py",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2023-09-21T16:12:08Z",
      "side": 1,
      "message": "I 100% support the changes to this file but they are orthogonal so I\u0027d separate them out to a different CL. Smaller is better.",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2855e994_c31cca4c",
        "filename": "ninjalog_uploader_wrapper.py",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1366072
      },
      "writtenOn": "2023-09-22T06:31:06Z",
      "side": 1,
      "message": "extracted the change https://crrev.com/c/4886532",
      "parentUuid": "fb02ef1a_40fd2142",
      "revId": "a57ec54702ebe41274dc747924224a444a624141",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}