{
  "comments": [
    {
      "key": {
        "uuid": "8d88bd2c_ca81fac8",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2019-08-20T18:07:37Z",
      "side": 1,
      "message": "shouldn\u0027t this be a guarantee of e.g. gclient? I thought we were supposed to be moving logic from bot_update to gclient, not the other way around?\n\nPlus, this will only check the \u0027main\u0027 project, not any DEPS\u0027d project or any other project in the .gclient file.",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2c9a202_5e82a011",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-08-20T23:21:28Z",
      "side": 1,
      "message": "OK, then I will change gclient to have flag check `git status` and complain if something left.\nWDYT?",
      "parentUuid": "8d88bd2c_ca81fac8",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9c71be8_99cfccef",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2019-08-21T00:18:02Z",
      "side": 1,
      "message": "I think that sounds right to me; Edward is more of a gclient owner than I am these days, though, so he\u0027d have to give final say.",
      "parentUuid": "c2c9a202_5e82a011",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "61a2af5c_98edb741",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1167909
      },
      "writtenOn": "2019-08-21T00:29:44Z",
      "side": 1,
      "message": "You can do \u0027gclient recurse git status --porcelain\u0027.",
      "parentUuid": "f9c71be8_99cfccef",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4246062c_ce9a00bc",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2019-08-21T01:43:27Z",
      "side": 1,
      "message": "My point is more that gclient should be able to assert the state of the repos that it ostensibly manages. We could continue to grow stuff in bot_update to do this, or (opinion) we could make gclient actually do its job correctly :)\n\nEach thing we add to bot_update to \"do gclient correctly\" is another pitfall that new gclient users have to encounter and work around.",
      "parentUuid": "61a2af5c_98edb741",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f65ac4a_c3d5b382",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1167909
      },
      "writtenOn": "2019-08-21T02:21:45Z",
      "side": 1,
      "message": "What is not clear to me is if we always want to make this check after syncing.\nIf we do, it does makes sense to put this in gclient.\nIf we don\u0027t, I think it\u0027s ok to leave it here, since it\u0027s something that gclient recurse can do and it\u0027s specific to bot_update.\n\nThe reason it\u0027s not clear to me is that this check fails on my infra checkout, and probably lots of developer checkouts, and might break people\u0027s workflows.",
      "parentUuid": "4246062c_ce9a00bc",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a0004ff_4aba11c4",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2019-08-21T04:27:53Z",
      "side": 1,
      "message": "Maybe I was misinformed then; I thought the long term goal was to have bot_update not exist, and for gclient to actually just be a standalone, robust tool. Is that not a goal?\n\nIMO `gclient recurse`, in general, is a hack. It means \"hey, gclient, you can\u0027t really answer a specific question about the repos you manage, let me reach into your implementation details and answer it myself\". In particular, the `gclient recurse` solution you propose would only work for git repos it manages, not for other DEPS types (like cipd), where nominally we\u0027d want to make sure they didn\u0027t have files they shouldn\u0027t, either.\n\nHowever, ultimately the chops source team is the one observing and guiding the growth of both gclient and bot_update, so if you think this should be bot_update specific logic, then so be it :).\n\nThere\u0027s already a plethora of flags to gclient which essentially mean \"hey, gclient, please do your job correctly instead of what you would otherwise do\". Flags like \"--force\", \"--delete_unversioned_trees\", and \"--reset\". Could we attach this behavior to one of those flags?",
      "parentUuid": "8f65ac4a_c3d5b382",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c44f7b5a_80a9ef21",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1161379
      },
      "writtenOn": "2019-08-21T06:48:23Z",
      "side": 1,
      "message": "I only want to have this check in bot_update or some other step in CQ.\nI don\u0027t take care whether the check is in gclient, bot_update or some other places.\n\nAnd I just added here because this seems easiest place to have the check.\n\nAlso I don\u0027t take care sub repositories because I rarely run `git status` there.",
      "parentUuid": "2a0004ff_4aba11c4",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b246807f_470e517b",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2019-08-21T17:01:16Z",
      "side": 1,
      "message": "Ultimately it\u0027s up to Edward. I think I\u0027ve said everything about it that I can say.",
      "parentUuid": "c44f7b5a_80a9ef21",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d1218e5_46c880a6",
        "filename": "recipes/recipe_modules/bot_update/resources/bot_update.py",
        "patchSetId": 2
      },
      "lineNbr": 1172,
      "author": {
        "id": 1167909
      },
      "writtenOn": "2019-08-21T18:46:21Z",
      "side": 1,
      "message": "Let\u0027s make gclient warn if untracked files were left behind after sync. I believe this might help with the problem this CL is trying to address.\n\nI noticed that on the bots, gclient is run using --force, --delete-unversioned-trees and --reset. These flags will make gclient scrub unversioned files [1] before updating, so I think a check like this wouldn\u0027t work.\n\nAlso, gclient does a soft reset after applying a patch by default [2], so I think a check like this would always fail on CQ bots.\n\n[1] https://cs.chromium.org/chromium/tools/depot_tools/gclient_scm.py?l\u003d286\n[2] https://cs.chromium.org/chromium/tools/depot_tools/gclient_scm.py?l\u003d465",
      "parentUuid": "b246807f_470e517b",
      "range": {
        "startLine": 1172,
        "startChar": 4,
        "endLine": 1172,
        "endChar": 10
      },
      "revId": "55402f41c5f2d3efd850f931d8335ee564219337",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}