{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8bd248b1_996809bc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2024-03-19T18:20:22Z",
      "side": 1,
      "message": "git cache is mainly used within our builders and this change would force all of them to re-fetch their cached repository again, which isn\u0027t ideal.\n\nCan you elaborate more on how exactly you\u0027re using this? Even if this is a bug, the migration should be done carefully to not affect the existing builders.",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d8c4e492_08b2c3f5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1588026
      },
      "writtenOn": "2024-03-20T05:55:16Z",
      "side": 1,
      "message": "1、How exactly you\u0027re using this?\nLike issue 329781388 says, I only set a GIT_CACHE_PATH environment variable to enable it in Win OS.\n2、About \"the migration should be done carefully to not affect the existing builders\":\nI will provide a minimal implementation to support ssh_url later. But I have a doubt: Why does the return value of \"CacheDirToUrl\" discard \".git\"? For example, the cache folder name is: chromium.googlesource.com-chromium-src, and its return value is https://chromium.googlesource.com/chromium/src, is obviously not a legal git_url. The reason may be that other code only uses part of the return value to determine, such as the only place where it is used (gclient_scm.py:773):\n```\ngit_cache.Mirror.CacheDirToUrl(current_url.rstrip(\u0027/\u0027)) \u003d\u003d git_cache.Mirror.CacheDirToUrl(url.rstrip(\u0027/\u0027))\n```\n\nSo, we will submit two parts of the changes, is this OK?\n1) Provide a minimal implementation to support ssh_url. Obviously at this stage, even internal builders use git_url in https form, so the https part will not be affected.\n2) Correct CacheDirToUrl to return a legal Git_URL, like: https://google.com/username/repository.git or git@google.com:username/repository.git\n\nLooking forward to your reply, thank you.",
      "parentUuid": "8bd248b1_996809bc",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e252d4bc_e0544cf7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2024-03-20T21:06:47Z",
      "side": 1,
      "message": "\u003e I only set a GIT_CACHE_PATH environment variable to enable it in Win OS.\n\niiuc, when you run git cache populate, it creates a bare repository from which you can clone your worktree. I\u0027m not sure if that\u0027s what you\u0027re doing. Can you add some replication steps?\n\n\u003e Why does the return value of \"CacheDirToUrl\" discard \".git\"?\n\nI\u0027m not exactly sure why this design choice was made. Looking at git blame, it seems to be present from the original implementation of git cache[1].\n\n@jojwang@chromium.org cc-ing as the current trooper.\n\n[1] https://codereview.chromium.org/164823002",
      "parentUuid": "d8c4e492_08b2c3f5",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c13c5b70_5f0f2107",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1529602
      },
      "writtenOn": "2024-03-20T21:26:54Z",
      "side": 1,
      "message": "Also, why not make a simple change to add an additional replace for \":\" character instead of completely changing the current cache dir naming convention?",
      "parentUuid": "e252d4bc_e0544cf7",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f262072_6d8ffc89",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1588026
      },
      "writtenOn": "2024-03-21T08:04:03Z",
      "side": 1,
      "message": "I have updated the minimal implementation, please help to see if it meets the requirements.",
      "parentUuid": "c13c5b70_5f0f2107",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "643b004f_bb7d46af",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1588026
      },
      "writtenOn": "2024-03-21T08:16:42Z",
      "side": 1,
      "message": "replication steps:\nIn Win CMD:\n```\ncd F:\\test\nset GIT_CACHE_PATH\u003df:\\test\\git_cache\ngclient config --name \"src\" --unmanaged git@github.com:chromium/chromium.git\ngclient sync\n```\nThe error will be found:\nOSError: [Errno 22] Invalid argument: \u0027f:\\\\test\\\\git_cache\\\\git@github.com:chromium-chromium\\\\HEAD\u0027",
      "parentUuid": "3f262072_6d8ffc89",
      "revId": "503ed49a546cd370982c8bd43e36e569c5ec0b38",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}