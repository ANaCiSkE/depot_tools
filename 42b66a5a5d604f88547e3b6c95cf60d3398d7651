{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "375c2fe7_1b99f21d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1115868
      },
      "writtenOn": "2021-05-26T04:31:45Z",
      "side": 1,
      "message": "I wonder if CIPD folks might be able to help with allowing multiple versions of the same package to live in the same manifest. It seems like it would simplify things. +iannucci, vadimsh any thoughts?",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2e56b618_712b450c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002539
      },
      "writtenOn": "2021-05-26T04:59:14Z",
      "side": 1,
      "message": "What are you asking for exactly?\n\nThe following manifest should work fine right now:\n\n```\n@Subdir python3.8\ninfra/3pp/tools/cpython3/${platform} version:2@3.8.10.chromium.17\n@Subdir python3.9\ninfra/3pp/tools/cpython3/${platform} version:2@3.9.5.chromium.17\n```\n\nAnd the following manifest makes little sense (how would CIPD know what version to pick when installing stuff into \"python3\" directory?):\n\n```\n@Subdir python3\ninfra/3pp/tools/cpython3/${platform} version:2@3.8.10.chromium.17\n@Subdir python3\ninfra/3pp/tools/cpython3/${platform} version:2@3.9.5.chromium.17\n```\n\nDo you want to install them one over another at the same time? This will require significant changes to CIPD guts (since CIPD needs to track what files belong to what package, so it can clean them up when the package is removed or updated, this tracking currently assumes of version of a package per directory).",
      "parentUuid": "375c2fe7_1b99f21d",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4d5528d_7a9bde57",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275796
      },
      "writtenOn": "2021-05-26T05:13:46Z",
      "side": 1,
      "message": "Ah, yeah I didn\u0027t think of this. It doesn\u0027t quite apply in depot_tools as is because depot_tools extracts the version from the manifest and uses that to name the directory via -root... perhaps we could reduce some of the complexity by just manually specifying the directory name in the manifest with @Subdir.\n\nI think depot_tools wants to use the full name of the package in the directory to avoid clobbering files used by currently running python processes.",
      "parentUuid": "2e56b618_712b450c",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5a69d9c2_0bca056e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001907
      },
      "writtenOn": "2021-05-26T19:01:45Z",
      "side": 1,
      "message": "However... when we update minor versions of python, don\u0027t they just get written into the same directory right now? Are devs having issues with that?",
      "parentUuid": "d4d5528d_7a9bde57",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "61414377_90bbda18",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2021-05-26T20:20:52Z",
      "side": 1,
      "message": "I feel like it might be good to have some documentation (if not a design doc) somewhere about how we expect this to work.\n\nSpecifically, I\u0027m wondering things like ...\n\n- will we download both 3.8 and 3.9 packages all the time, or download one by default and only download the other when asked for by vpython?\n\n- how will we update from 3.8 to 3.9 in python-bin/ ?\n\n- will `python3.9` be exposed as an executable directly?\n\nhow will 3.10 be treated?\n\netc.",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3f7b452b_4fe409fe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275796
      },
      "writtenOn": "2021-06-01T02:49:23Z",
      "side": 1,
      "message": "No, I don\u0027t think so. The directory is named with the full version string of the CIPD package (e.g. bootstrap-2@3.8.10.chromium.17_bin). IIUC, when the version is updated we download the new version into its own directory, named with the new version string, and then delete the old version.",
      "parentUuid": "5a69d9c2_0bca056e",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7394aafb_9aeb257b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275796
      },
      "writtenOn": "2021-06-01T02:49:23Z",
      "side": 1,
      "message": "Where do you think this documentation should live? In a comment somewhere in depot_tools? To answer the specific questions:\n\n* Yes, we download both all the time. I can\u0027t think of any way to do it lazily without a lot of changes to vpython or some serious hackery. The unpacked size is about 85MB on my Linux workstation.\n* Ah, I didn\u0027t know about python-bin also using the packages. What\u0027s it used for? We could update it straightforwardly by changing the path in the python-bin/python3 script, or by putting the 3.9 version into python3_bin_reldir.txt instead.\n* I hadn\u0027t planned on it. Do you think it\u0027s necessary? I guess this ties into the previous question about what uses the depot_tools Python directly.\n* I plan on adding 3.10 the same way as I\u0027m adding 3.9 in this CL. With this machinery in place it should be straightforward.",
      "parentUuid": "61414377_90bbda18",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10567313_3b4340d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2021-06-01T20:50:33Z",
      "side": 1,
      "message": "Good question.\n\nWe should probably create a //docs directory in depot_tools, and start adding stuff to it, e.g., moving the *.html files from //man/html for starters.\n\nWe should also figure out what, if anything should be moved out of GDoc form from https://docs.google.com/document/d/19kEKsm769DwIhMhl78kVb0qE1S-9_v9OYDF43WmyPBI/edit#heading\u003dh.insyfkf0vu5m and https://docs.google.com/document/d/1a2H9tvWsNO8hXZVSp48T7QHwSMWvacoZjBqngDSk94M/edit#heading\u003dh.cdh3codmursa.\n\n//python-bin/ is the directory we recommend people put in $PATH if they don\u0027t have a system-provided python that is \u003e\u003d 3.8.\n\nI think we need *some* strategy for how we will roll forward python3 minor versions, both for internal (depot_tools-based) uses of Python and external (provided for users) uses, and I think we should re-review the discussion in the latter GDoc for why combining things in a single directory gets hard.\n\nI don\u0027t remember enough of that offhand to know whether we can realistically manage multiple directories and whether each should have just a `python3`, just a `python3.X`, or both.",
      "parentUuid": "7394aafb_9aeb257b",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afb645f0_30bf13b5",
        "filename": "vpython3",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2021-05-26T20:20:52Z",
      "side": 1,
      "message": "It would be good to document somewhere (maybe here, in comments) why we \nneed these flags, as opposed to this being baked into vpython directly\nor via some sort of config file ...\n\nI don\u0027t really like the wrappers growing additional logic that isn\u0027t in the\nbase executable; it creates too much of dependency on depot_tools.",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6566766_fd247374",
        "filename": "vpython3",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1275796
      },
      "writtenOn": "2021-06-01T02:49:23Z",
      "side": 1,
      "message": "Not sure I understand. This is specific to the depot_tools checkout, how would we bake it into vpython? Is the idea to update the infra vpython binary to download and manage the Python packages itself?",
      "parentUuid": "afb645f0_30bf13b5",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57fde12e_d262d310",
        "filename": "vpython3",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2021-06-01T20:50:33Z",
      "side": 1,
      "message": "Yes, or it could have some way to discover this based on the vpython specs, or something ...",
      "parentUuid": "d6566766_fd247374",
      "revId": "42b66a5a5d604f88547e3b6c95cf60d3398d7651",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}