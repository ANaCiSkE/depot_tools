{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ffd910ec_c2538973",
        "filename": "git_auth.py",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1560543
      },
      "writtenOn": "2024-09-17T17:34:43Z",
      "side": 1,
      "message": "I\u0027m getting:\n\n```\n\nauth(197) _get_luci_auth_token:luci-auth token failed: Command \u0027luci-auth token -scopes https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/gerritcodereview -json-output -\u0027 returned non-zero exit status 1\nNot logged in.\n\nLogin by running:\n   $ luci-auth login -scopes \"https://www.googleapis.com/auth/gerritcodereview https://www.googleapis.com/auth/userinfo.email\"\n\nSyncing projects: 100% (260/260) src/third_party/beto-core/src\nsrc/third_party/beto-core/src (ERROR)\n----------------------------------------\n[0:00:02] Started.\n[0:00:02]\n----------------------------------------\nTraceback (most recent call last):\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/metrics.py\", line 302, in print_notice_and_exit\n    yield\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient.py\", line 4638, in \u003cmodule\u003e\n    sys.exit(main(sys.argv[1:]))\n             ^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient.py\", line 4624, in main\n    return dispatcher.execute(OptionParser(), argv)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/subcommand.py\", line 254, in execute\n    return command(parser, args[1:])\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient.py\", line 3977, in CMDsync\n    ret \u003d client.RunOnDeps(\u0027update\u0027, args)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient.py\", line 2436, in RunOnDeps\n    work_queue.flush(revision_overrides,\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_utils.py\", line 1026, in flush\n    reraise(e[0], e[1], e[2])\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_utils.py\", line 53, in reraise\n    raise value\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_utils.py\", line 1105, in run\n    self.item.run(*self.args, **self.kwargs)\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient.py\", line 1251, in run\n    self._got_revision \u003d self._used_scm.RunCommand(\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_scm.py\", line 137, in RunCommand\n    return getattr(self, command)(options, args, file_list)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_scm.py\", line 664, in wrapper\n    return_val \u003d f(*args)\n                 ^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_scm.py\", line 814, in update\n    self.current_revision \u003d self._Clone(revision, url, options)\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gclient_scm.py\", line 1353, in _Clone\n    git_auth.ConfigureGlobal(\u0027/\u0027, url)\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/git_auth.py\", line 305, in ConfigureGlobal\n    ConfigChanger.new_for_remote(cwd, remote_url).apply_global(cwd)\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/git_auth.py\", line 122, in new_for_remote\n    c.mode \u003d cls._infer_mode(cwd, c._shortname + \u0027-review.googlesource.com\u0027)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/git_auth.py\", line 134, in _infer_mode\n    info \u003d gerrit_util.GetAccountDetails(gerrit_host,\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gerrit_util.py\", line 1811, in GetAccountDetails\n    conn \u003d CreateHttpConn(host,\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gerrit_util.py\", line 983, in CreateHttpConn\n    authenticator.authenticate(conn)\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/gerrit_util.py\", line 818, in authenticate\n    \u0027Authorization\u0027] \u003d f\u0027Bearer {self._authenticator.get_access_token().token}\u0027\n                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/google/home/sokcevic/source/depot_tools/auth.py\", line 111, in get_access_token\n    raise LoginRequiredError(self._scopes)\nauth.LoginRequiredError: You are not logged in. Please login first by running:\n  luci-auth login -scopes \"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/gerritcodereview\"\n\n```\n\nI think we should use no auth. Also, how often do we need to call GetAccountDetails? Is it every gclient sync? If so, maybe it\u0027s better not to call it, or at least cache it on disk (TTL several days?).",
      "revId": "2fe7b1494987f564d15e85b2715a8641aea2dabc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d490b71_6e21c3c4",
        "filename": "git_auth.py",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 3355336
      },
      "writtenOn": "2024-09-17T20:16:08Z",
      "side": 1,
      "message": "Ugh, that\u0027s annoying.  We can\u0027t use no auth since this is also a problem on chrome-internal (I assume anonymous users can\u0027t query random accounts).",
      "parentUuid": "ffd910ec_c2538973",
      "revId": "2fe7b1494987f564d15e85b2715a8641aea2dabc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8690c9b_3850fd82",
        "filename": "git_auth.py",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1560543
      },
      "writtenOn": "2024-09-17T20:48:03Z",
      "side": 1,
      "message": "Yes, it\u0027s not possible to query accounts in chrome-internal without being logged in.\n\nA few options I can think of:\n* have a way to know what hosts are public vs private - that way we can force auth on private, and not on public. We would still need to handle this exception somehow, though.\n* always require luci-auth for newAuth. This is one-time, and aligns with future plans.\n\nI\u0027m leaning towards the second option.",
      "parentUuid": "0d490b71_6e21c3c4",
      "revId": "2fe7b1494987f564d15e85b2715a8641aea2dabc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "43f45686_a8356388",
        "filename": "git_auth.py",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 3355336
      },
      "writtenOn": "2024-09-17T21:41:19Z",
      "side": 1,
      "message": "Have a working solution I think.  Basically, fall back to no auth if user isn\u0027t logged in, and print a reminder to login when running git cl creds-check (the de facto command to run for any auth issues)",
      "parentUuid": "c8690c9b_3850fd82",
      "revId": "2fe7b1494987f564d15e85b2715a8641aea2dabc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "479df466_c4a14679",
        "filename": "git_auth.py",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1560543
      },
      "writtenOn": "2024-09-17T22:26:14Z",
      "side": 1,
      "message": "Opening a new thread.",
      "parentUuid": "43f45686_a8356388",
      "revId": "2fe7b1494987f564d15e85b2715a8641aea2dabc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}